{
  "openapi": "3.0.1",
  "info": {
    "title": "FSM + HATEOAS Rails API",
    "version": "v1",
    "description": "API demonstrating Finite State Machines with HATEOAS hypermedia controls for simplified UI development. This API provides self-descriptive resources where available actions are determined by the current state and user permissions.",
    "contact": {
      "name": "API Support",
      "url": "https://github.com/yourusername/simplified-ui-development"
    }
  },
  "paths": {
    "/articles": {
      "get": {
        "summary": "Retrieves all published articles",
        "tags": [
          "Articles"
        ],
        "description": "Returns a collection of published articles with hypermedia controls (HATEOAS). Each article includes its current FSM state and available state transitions based on user permissions.",
        "responses": {
          "200": {
            "description": "articles found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ArticlesCollection"
                }
              }
            }
          }
        }
      },
      "post": {
        "summary": "Creates a new article",
        "tags": [
          "Articles"
        ],
        "description": "Creates a new article in \"draft\" state. Requires authentication.",
        "security": [
          {
            "session_auth": [

            ]
          }
        ],
        "parameters": [

        ],
        "responses": {
          "201": {
            "description": "article created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "article": {
                      "$ref": "#/components/schemas/Article"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "422": {
            "description": "invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "errors": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "title": {
                    "type": "string",
                    "example": "Introduction to FSM"
                  },
                  "content": {
                    "type": "string",
                    "example": "This article explains finite state machines..."
                  }
                },
                "required": [
                  "title",
                  "content"
                ]
              }
            }
          }
        }
      }
    },
    "/articles/my_articles": {
      "get": {
        "summary": "Retrieves current user's articles",
        "tags": [
          "Articles"
        ],
        "description": "Returns all articles created by the authenticated user, regardless of state.",
        "security": [
          {
            "session_auth": [

            ]
          }
        ],
        "responses": {
          "200": {
            "description": "my articles found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ArticlesCollection"
                }
              }
            }
          },
          "401": {
            "description": "unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/articles/articles_for_review": {
      "get": {
        "summary": "Retrieves articles pending review",
        "tags": [
          "Articles"
        ],
        "description": "Returns all articles in \"review\" state. Requires editor or admin role.",
        "security": [
          {
            "session_auth": [

            ]
          }
        ],
        "responses": {
          "200": {
            "description": "articles for review found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ArticlesCollection"
                }
              }
            }
          },
          "401": {
            "description": "unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "403": {
            "description": "forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/articles/deleted_articles": {
      "get": {
        "summary": "Retrieves archived articles",
        "tags": [
          "Articles"
        ],
        "description": "Returns archived articles. Admins see all archived articles, regular users see only their own.",
        "security": [
          {
            "session_auth": [

            ]
          }
        ],
        "responses": {
          "200": {
            "description": "archived articles found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ArticlesCollection"
                }
              }
            }
          },
          "401": {
            "description": "unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/articles/{id}": {
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "description": "Article ID",
          "required": true,
          "schema": {
            "type": "integer"
          }
        }
      ],
      "get": {
        "summary": "Retrieves a specific article (HAL-style with embedded comments)",
        "tags": [
          "Articles"
        ],
        "description": "Returns a single article with HAL-style _embedded comments. Demonstrates hypermedia format with nested resources following HAL conventions.",
        "responses": {
          "200": {
            "description": "article found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "integer",
                      "example": 1
                    },
                    "title": {
                      "type": "string",
                      "example": "Introduction to FSM"
                    },
                    "content": {
                      "type": "string",
                      "example": "This article explains..."
                    },
                    "status": {
                      "type": "string",
                      "enum": [
                        "draft",
                        "review",
                        "rejected",
                        "published",
                        "privated",
                        "archived"
                      ],
                      "example": "published"
                    },
                    "links": {
                      "type": "array",
                      "description": "HATEOAS links for available actions",
                      "items": {
                        "$ref": "#/components/schemas/HypermediaLink"
                      }
                    },
                    "_embedded": {
                      "type": "object",
                      "description": "HAL-style embedded resources",
                      "properties": {
                        "comments": {
                          "type": "array",
                          "description": "Embedded comments for this article",
                          "items": {
                            "$ref": "#/components/schemas/Comment"
                          }
                        }
                      }
                    }
                  },
                  "example": {
                    "id": 1,
                    "title": "Getting Started with FSM",
                    "content": "Finite State Machines simplify complex workflows...",
                    "status": "published",
                    "links": [
                      {
                        "rel": "self",
                        "title": "Show",
                        "method": "GET",
                        "href": "/articles/1",
                        "button_classes": "btn btn-outline-primary btn-sm mx-1"
                      },
                      {
                        "rel": "transition:archive",
                        "title": "Archive",
                        "method": "POST",
                        "href": "/articles/1/archive",
                        "button_classes": "btn btn-outline-secondary btn-sm mx-1"
                      }
                    ],
                    "_embedded": {
                      "comments": [
                        {
                          "id": 1,
                          "text": "Great article!",
                          "status": "approved",
                          "links": [
                            {
                              "rel": "self",
                              "title": "Show",
                              "method": "GET",
                              "href": "/comments/1"
                            }
                          ]
                        },
                        {
                          "id": 2,
                          "text": "Very informative",
                          "status": "approved",
                          "links": [
                            {
                              "rel": "self",
                              "title": "Show",
                              "method": "GET",
                              "href": "/comments/2"
                            }
                          ]
                        }
                      ]
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "article not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      },
      "delete": {
        "summary": "Deletes an article",
        "tags": [
          "Articles"
        ],
        "description": "Permanently deletes an article. Requires ownership or admin role.",
        "security": [
          {
            "session_auth": [

            ]
          }
        ],
        "responses": {
          "204": {
            "description": "article deleted"
          },
          "401": {
            "description": "unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "403": {
            "description": "forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "404": {
            "description": "article not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/articles/{id}/submit": {
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "description": "Article ID",
          "required": true,
          "schema": {
            "type": "integer"
          }
        }
      ],
      "post": {
        "summary": "Submit article for review (draft → review)",
        "tags": [
          "Articles - FSM Transitions"
        ],
        "description": "Transitions article from \"draft\" to \"review\" state. Requires article ownership.",
        "security": [
          {
            "session_auth": [

            ]
          }
        ],
        "responses": {
          "200": {
            "description": "transition successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TransitionSuccess"
                }
              }
            }
          },
          "401": {
            "description": "unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "403": {
            "description": "forbidden - not allowed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "422": {
            "description": "invalid state transition",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TransitionError"
                }
              }
            }
          }
        }
      }
    },
    "/articles/{id}/publish": {
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "description": "Article ID",
          "required": true,
          "schema": {
            "type": "integer"
          }
        }
      ],
      "post": {
        "summary": "Publish article (review → published)",
        "tags": [
          "Articles - FSM Transitions"
        ],
        "description": "Transitions article from \"review\" to \"published\" state. Requires editor or admin role.",
        "security": [
          {
            "session_auth": [

            ]
          }
        ],
        "responses": {
          "200": {
            "description": "transition successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TransitionSuccess"
                }
              }
            }
          },
          "401": {
            "description": "unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "403": {
            "description": "forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "422": {
            "description": "invalid state transition",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TransitionError"
                }
              }
            }
          }
        }
      }
    },
    "/articles/{id}/reject": {
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "description": "Article ID",
          "required": true,
          "schema": {
            "type": "integer"
          }
        }
      ],
      "post": {
        "summary": "Reject article (review → rejected)",
        "tags": [
          "Articles - FSM Transitions"
        ],
        "description": "Transitions article from \"review\" to \"rejected\" state with feedback. Requires admin role.",
        "security": [
          {
            "session_auth": [

            ]
          }
        ],
        "parameters": [

        ],
        "responses": {
          "200": {
            "description": "transition successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TransitionSuccess"
                }
              }
            }
          },
          "401": {
            "description": "unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "403": {
            "description": "forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "422": {
            "description": "validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TransitionError"
                }
              }
            }
          }
        },
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "rejection_feedback": {
                    "type": "string",
                    "example": "Please improve the introduction and add more examples.",
                    "description": "Detailed feedback explaining why the article is being rejected"
                  }
                },
                "required": [
                  "rejection_feedback"
                ]
              }
            }
          }
        }
      }
    },
    "/articles/{id}/approve_private": {
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "description": "Article ID",
          "required": true,
          "schema": {
            "type": "integer"
          }
        }
      ],
      "post": {
        "summary": "Approve article as private (review → privated)",
        "tags": [
          "Articles - FSM Transitions"
        ],
        "description": "Transitions article from \"review\" to \"privated\" state. Requires editor or admin role.",
        "security": [
          {
            "session_auth": [

            ]
          }
        ],
        "responses": {
          "200": {
            "description": "transition successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TransitionSuccess"
                }
              }
            }
          },
          "401": {
            "description": "unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "403": {
            "description": "forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/articles/{id}/resubmit": {
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "description": "Article ID",
          "required": true,
          "schema": {
            "type": "integer"
          }
        }
      ],
      "post": {
        "summary": "Resubmit rejected article (rejected → review)",
        "tags": [
          "Articles - FSM Transitions"
        ],
        "description": "Transitions article from \"rejected\" back to \"review\" state. Requires article ownership.",
        "security": [
          {
            "session_auth": [

            ]
          }
        ],
        "responses": {
          "200": {
            "description": "transition successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TransitionSuccess"
                }
              }
            }
          },
          "401": {
            "description": "unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "403": {
            "description": "forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/articles/{id}/archive": {
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "description": "Article ID",
          "required": true,
          "schema": {
            "type": "integer"
          }
        }
      ],
      "post": {
        "summary": "Archive article",
        "tags": [
          "Articles - FSM Transitions"
        ],
        "description": "Transitions article to \"archived\" state from rejected, published, or privated. Requires admin role.",
        "security": [
          {
            "session_auth": [

            ]
          }
        ],
        "responses": {
          "200": {
            "description": "transition successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TransitionSuccess"
                }
              }
            }
          },
          "401": {
            "description": "unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "403": {
            "description": "forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/articles/{id}/make_visible": {
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "description": "Article ID",
          "required": true,
          "schema": {
            "type": "integer"
          }
        }
      ],
      "post": {
        "summary": "Make article visible (privated → published)",
        "tags": [
          "Articles - FSM Transitions"
        ],
        "description": "Transitions article from \"privated\" to \"published\" state. Requires admin role.",
        "security": [
          {
            "session_auth": [

            ]
          }
        ],
        "responses": {
          "200": {
            "description": "transition successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TransitionSuccess"
                }
              }
            }
          },
          "401": {
            "description": "unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "403": {
            "description": "forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/articles/{id}/make_invisible": {
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "description": "Article ID",
          "required": true,
          "schema": {
            "type": "integer"
          }
        }
      ],
      "post": {
        "summary": "Make article invisible (published → privated)",
        "tags": [
          "Articles - FSM Transitions"
        ],
        "description": "Transitions article from \"published\" to \"privated\" state. Requires admin role.",
        "security": [
          {
            "session_auth": [

            ]
          }
        ],
        "responses": {
          "200": {
            "description": "transition successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TransitionSuccess"
                }
              }
            }
          },
          "401": {
            "description": "unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "403": {
            "description": "forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/comments/pending_comments": {
      "get": {
        "summary": "Retrieves all pending comments",
        "tags": [
          "Comments"
        ],
        "description": "Returns all comments in \"pending\" state awaiting moderation. Requires moderator or admin role.",
        "security": [
          {
            "session_auth": [

            ]
          }
        ],
        "responses": {
          "200": {
            "description": "pending comments found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "comments": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Comment"
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "403": {
            "description": "forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/comments/{id}": {
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "description": "Comment ID",
          "required": true,
          "schema": {
            "type": "integer"
          }
        }
      ],
      "get": {
        "summary": "Retrieves a specific comment",
        "tags": [
          "Comments"
        ],
        "description": "Returns a single comment with available actions based on current state and user permissions.",
        "responses": {
          "200": {
            "description": "comment found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "comment": {
                      "type": "string",
                      "description": "Rendered HTML content with hypermedia links"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "comment not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      },
      "patch": {
        "summary": "Update comment",
        "tags": [
          "Comments"
        ],
        "description": "Update comment text. Only allowed for rejected comments. Automatically moves to pending state.",
        "security": [
          {
            "session_auth": [

            ]
          }
        ],
        "parameters": [

        ],
        "responses": {
          "200": {
            "description": "comment updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "comment": {
                      "$ref": "#/components/schemas/Comment"
                    }
                  }
                }
              }
            }
          },
          "422": {
            "description": "validation error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "errors": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            }
          },
          "403": {
            "description": "forbidden - not editable",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "401": {
            "description": "unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        },
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "text": {
                    "type": "string",
                    "example": "Updated comment text"
                  }
                },
                "required": [
                  "text"
                ]
              }
            }
          }
        }
      },
      "delete": {
        "summary": "Deletes a comment",
        "tags": [
          "Comments"
        ],
        "description": "Permanently deletes a comment. Requires ownership or admin role.",
        "security": [
          {
            "session_auth": [

            ]
          }
        ],
        "responses": {
          "204": {
            "description": "comment deleted"
          },
          "401": {
            "description": "unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "403": {
            "description": "forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "404": {
            "description": "comment not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/comments/{id}/edit": {
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "description": "Comment ID",
          "required": true,
          "schema": {
            "type": "integer"
          }
        }
      ],
      "get": {
        "summary": "Get comment edit form",
        "tags": [
          "Comments"
        ],
        "description": "Returns HTML form for editing comment. Only available for rejected comments.",
        "security": [
          {
            "session_auth": [

            ]
          }
        ],
        "responses": {
          "200": {
            "description": "edit form retrieved",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "form": {
                      "type": "string",
                      "description": "HTML form for editing comment"
                    }
                  }
                }
              }
            }
          },
          "403": {
            "description": "forbidden - not editable",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "401": {
            "description": "unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/articles/{article_id}/comments": {
      "parameters": [
        {
          "name": "article_id",
          "in": "path",
          "description": "Article ID",
          "required": true,
          "schema": {
            "type": "integer"
          }
        }
      ],
      "post": {
        "summary": "Creates a new comment",
        "tags": [
          "Comments"
        ],
        "description": "Creates a new comment in \"pending\" state. Requires authentication.",
        "security": [
          {
            "session_auth": [

            ]
          }
        ],
        "parameters": [

        ],
        "responses": {
          "201": {
            "description": "comment created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "comment": {
                      "$ref": "#/components/schemas/Comment"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "404": {
            "description": "article not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "422": {
            "description": "invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "errors": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "text": {
                    "type": "string",
                    "example": "Great article! Very informative.",
                    "minLength": 1,
                    "maxLength": 250
                  }
                },
                "required": [
                  "text"
                ]
              }
            }
          }
        }
      }
    },
    "/comments/{id}/approve": {
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "description": "Comment ID",
          "required": true,
          "schema": {
            "type": "integer"
          }
        }
      ],
      "post": {
        "summary": "Approve comment (pending → approved)",
        "tags": [
          "Comments - FSM Transitions"
        ],
        "description": "Transitions comment from \"pending\" to \"approved\" state, making it publicly visible. Requires admin role.",
        "security": [
          {
            "session_auth": [

            ]
          }
        ],
        "responses": {
          "200": {
            "description": "transition successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "comment": {
                      "$ref": "#/components/schemas/Comment"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "403": {
            "description": "forbidden - insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "422": {
            "description": "invalid state transition",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "errors": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/comments/{id}/reject": {
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "description": "Comment ID",
          "required": true,
          "schema": {
            "type": "integer"
          }
        }
      ],
      "post": {
        "summary": "Reject comment (pending → rejected)",
        "tags": [
          "Comments - FSM Transitions"
        ],
        "description": "Transitions comment from \"pending\" to \"rejected\" state with feedback. Requires admin role.",
        "security": [
          {
            "session_auth": [

            ]
          }
        ],
        "parameters": [

        ],
        "responses": {
          "200": {
            "description": "transition successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "comment": {
                      "$ref": "#/components/schemas/Comment"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "403": {
            "description": "forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "422": {
            "description": "validation error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "errors": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "rejection_feedback": {
                    "type": "string",
                    "example": "Please be more constructive in your feedback.",
                    "description": "Detailed feedback explaining why the comment is being rejected"
                  }
                },
                "required": [
                  "rejection_feedback"
                ]
              }
            }
          }
        }
      }
    },
    "/comments/{id}/delete": {
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "description": "Comment ID",
          "required": true,
          "schema": {
            "type": "integer"
          }
        }
      ],
      "post": {
        "summary": "Soft delete comment (pending/approved → deleted)",
        "tags": [
          "Comments - FSM Transitions"
        ],
        "description": "Transitions comment to \"deleted\" state. Can be restored later. Requires comment ownership, admin, or editor role.",
        "security": [
          {
            "session_auth": [

            ]
          }
        ],
        "responses": {
          "200": {
            "description": "transition successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "comment": {
                      "$ref": "#/components/schemas/Comment"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "403": {
            "description": "forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "422": {
            "description": "invalid state transition",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "errors": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/comments/{id}/restore": {
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "description": "Comment ID",
          "required": true,
          "schema": {
            "type": "integer"
          }
        }
      ],
      "post": {
        "summary": "Restore deleted comment (deleted → pending)",
        "tags": [
          "Comments - FSM Transitions"
        ],
        "description": "Transitions comment from \"deleted\" back to \"pending\" state. Requires admin or editor role.",
        "security": [
          {
            "session_auth": [

            ]
          }
        ],
        "responses": {
          "200": {
            "description": "transition successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "comment": {
                      "$ref": "#/components/schemas/Comment"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "403": {
            "description": "forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "422": {
            "description": "invalid state transition",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "errors": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/state_transitions": {
      "get": {
        "summary": "Retrieves all state transitions (audit log)",
        "tags": [
          "State Transitions"
        ],
        "description": "Returns a complete audit log of all FSM state transitions for articles and comments. Shows who made the transition, when, and what changed. Requires admin role.",
        "security": [
          {
            "bearer_auth": [

            ]
          }
        ],
        "responses": {
          "200": {
            "description": "state transitions found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "state_transitions": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/StateTransition"
                      }
                    }
                  },
                  "example": {
                    "state_transitions": [
                      {
                        "id": 1,
                        "transitionable_type": "Article",
                        "transitionable_id": 5,
                        "from_state": "draft",
                        "to_state": "review",
                        "event": "submit",
                        "user_id": 1,
                        "created_at": "2024-10-09T14:23:45Z",
                        "updated_at": "2024-10-09T14:23:45Z"
                      },
                      {
                        "id": 2,
                        "transitionable_type": "Article",
                        "transitionable_id": 5,
                        "from_state": "review",
                        "to_state": "published",
                        "event": "publish",
                        "user_id": 2,
                        "created_at": "2024-10-09T15:30:12Z",
                        "updated_at": "2024-10-09T15:30:12Z"
                      },
                      {
                        "id": 3,
                        "transitionable_type": "Comment",
                        "transitionable_id": 12,
                        "from_state": "pending",
                        "to_state": "approved",
                        "event": "approve",
                        "user_id": 2,
                        "created_at": "2024-10-09T16:45:33Z",
                        "updated_at": "2024-10-09T16:45:33Z"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "403": {
            "description": "forbidden - requires admin role",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    }
  },
  "servers": [
    {
      "url": "http://{defaultHost}",
      "variables": {
        "defaultHost": {
          "default": "localhost:3000"
        }
      }
    }
  ],
  "components": {
    "securitySchemes": {
      "session_auth": {
        "type": "apiKey",
        "in": "cookie",
        "name": "_simplified_ui_development_session",
        "description": "Session-based authentication via Devise. Include session cookie in requests."
      }
    },
    "schemas": {
      "HypermediaLink": {
        "type": "object",
        "properties": {
          "rel": {
            "type": "string",
            "description": "Link relation type (RFC 5988)",
            "example": "transition:publish"
          },
          "title": {
            "type": "string",
            "description": "Human-readable action label",
            "example": "Publish Article"
          },
          "method": {
            "type": "string",
            "enum": [
              "GET",
              "POST",
              "PUT",
              "PATCH",
              "DELETE"
            ],
            "description": "HTTP method",
            "example": "POST"
          },
          "href": {
            "type": "string",
            "description": "URL endpoint",
            "example": "/articles/1/publish"
          },
          "button_classes": {
            "type": "string",
            "description": "CSS classes for UI rendering",
            "example": "btn btn-success",
            "nullable": true
          },
          "confirm": {
            "type": "string",
            "description": "Confirmation message for destructive actions",
            "example": "Are you sure?",
            "nullable": true
          }
        },
        "required": [
          "rel",
          "title",
          "method",
          "href"
        ]
      },
      "Article": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "example": 1
          },
          "title": {
            "type": "string",
            "example": "Introduction to Rails"
          },
          "content": {
            "type": "string",
            "example": "This is a comprehensive guide to Ruby on Rails..."
          },
          "status": {
            "type": "string",
            "enum": [
              "draft",
              "review",
              "rejected",
              "published",
              "privated",
              "archived"
            ],
            "example": "published",
            "description": "Current FSM state of the article"
          },
          "user_id": {
            "type": "integer",
            "example": 1,
            "description": "ID of the author"
          },
          "rejection_feedback": {
            "type": "string",
            "example": "Please improve the introduction and add more examples.",
            "description": "Feedback provided when article was rejected (only visible to admin and author)",
            "nullable": true
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "example": "2024-10-09T12:00:00Z"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "example": "2024-10-09T14:30:00Z"
          },
          "links": {
            "type": "array",
            "description": "HATEOAS hypermedia controls - available actions based on current state",
            "items": {
              "$ref": "#/components/schemas/HypermediaLink"
            }
          }
        },
        "required": [
          "id",
          "title",
          "content",
          "status",
          "links"
        ]
      },
      "ArticlesCollection": {
        "type": "object",
        "properties": {
          "articles": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Article"
            }
          },
          "links": {
            "type": "array",
            "description": "Global navigation links",
            "items": {
              "$ref": "#/components/schemas/HypermediaLink"
            }
          }
        },
        "required": [
          "articles",
          "links"
        ]
      },
      "Article2": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "example": "550e8400-e29b-41d4-a716-446655440000",
            "description": "UUID identifier"
          },
          "title": {
            "type": "string",
            "example": "Event-Sourced Article"
          },
          "content": {
            "type": "string",
            "example": "This article uses event sourcing for state management..."
          },
          "status": {
            "type": "string",
            "enum": [
              "draft",
              "review",
              "rejected",
              "published",
              "privated",
              "archived"
            ],
            "example": "published",
            "description": "Current state reconstructed from events"
          },
          "user_id": {
            "type": "integer",
            "example": 1,
            "description": "ID of the author"
          },
          "rejection_feedback": {
            "type": "string",
            "example": "Please improve the introduction and add more examples.",
            "description": "Feedback provided when article was rejected (only visible to admin and author)",
            "nullable": true
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "example": "2024-10-09T12:00:00Z"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "example": "2024-10-09T14:30:00Z"
          },
          "links": {
            "type": "array",
            "description": "HATEOAS hypermedia controls - available actions based on current state",
            "items": {
              "$ref": "#/components/schemas/HypermediaLink"
            }
          },
          "_embedded": {
            "type": "object",
            "description": "HAL-style embedded resources",
            "properties": {
              "comment2s": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Comment2"
                }
              }
            }
          }
        },
        "required": [
          "id",
          "title",
          "content",
          "status",
          "links"
        ]
      },
      "Comment2": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "example": "550e8400-e29b-41d4-a716-446655440001",
            "description": "UUID identifier"
          },
          "text": {
            "type": "string",
            "example": "Great event-sourced article! Very informative."
          },
          "status": {
            "type": "string",
            "enum": [
              "pending",
              "approved",
              "rejected",
              "deleted"
            ],
            "example": "approved",
            "description": "Current state reconstructed from events"
          },
          "article2_id": {
            "type": "string",
            "example": "550e8400-e29b-41d4-a716-446655440000",
            "description": "UUID of the parent article"
          },
          "user_id": {
            "type": "integer",
            "example": 3,
            "description": "ID of the comment author"
          },
          "rejection_feedback": {
            "type": "string",
            "example": "Please be more constructive in your feedback.",
            "description": "Feedback provided when comment was rejected (only visible to admin and author)",
            "nullable": true
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "example": "2024-10-09T13:45:00Z"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "example": "2024-10-09T13:45:00Z"
          },
          "links": {
            "type": "array",
            "description": "HATEOAS hypermedia controls - available actions based on current state",
            "items": {
              "$ref": "#/components/schemas/HypermediaLink"
            }
          }
        },
        "required": [
          "id",
          "text",
          "status",
          "links"
        ]
      },
      "Event": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "example": 1,
            "description": "Event log entry ID"
          },
          "aggregate_id": {
            "type": "string",
            "example": "550e8400-e29b-41d4-a716-446655440000",
            "description": "UUID of the aggregate"
          },
          "aggregate_type": {
            "type": "string",
            "enum": [
              "Article2",
              "Comment2"
            ],
            "example": "Article2",
            "description": "Type of aggregate that generated the event"
          },
          "event_type": {
            "type": "string",
            "example": "Article2Created",
            "description": "Type of domain event"
          },
          "event_data": {
            "type": "object",
            "example": {
              "title": "New Article",
              "content": "Article content",
              "user_id": 1
            },
            "description": "Event payload data"
          },
          "version": {
            "type": "integer",
            "example": 1,
            "description": "Event version for optimistic concurrency"
          },
          "occurred_at": {
            "type": "string",
            "format": "date-time",
            "example": "2024-10-09T14:23:45Z",
            "description": "When the event occurred"
          },
          "correlation_id": {
            "type": "string",
            "example": "req-123",
            "description": "Correlation ID for tracing",
            "nullable": true
          },
          "causation_id": {
            "type": "string",
            "example": "cmd-456",
            "description": "Causation ID for command tracking",
            "nullable": true
          },
          "metadata": {
            "type": "object",
            "example": {
              "user_id": 1
            },
            "description": "Additional event metadata",
            "nullable": true
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "example": "2024-10-09T14:23:45Z"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "example": "2024-10-09T14:23:45Z"
          }
        },
        "required": [
          "id",
          "aggregate_id",
          "aggregate_type",
          "event_type",
          "event_data",
          "version",
          "occurred_at"
        ]
      },
      "StateTransition": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "example": 1,
            "description": "Transition log entry ID"
          },
          "transitionable_type": {
            "type": "string",
            "enum": [
              "Article",
              "Comment"
            ],
            "example": "Article",
            "description": "Type of resource that transitioned"
          },
          "transitionable_id": {
            "type": "integer",
            "example": 5,
            "description": "ID of the resource that transitioned"
          },
          "from_state": {
            "type": "string",
            "example": "draft",
            "description": "State before transition"
          },
          "to_state": {
            "type": "string",
            "example": "review",
            "description": "State after transition"
          },
          "event": {
            "type": "string",
            "example": "submit",
            "description": "FSM event that triggered the transition"
          },
          "user_id": {
            "type": "integer",
            "example": 1,
            "description": "ID of user who triggered the transition"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "example": "2024-10-09T14:23:45Z"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "example": "2024-10-09T14:23:45Z"
          }
        },
        "required": [
          "id",
          "transitionable_type",
          "transitionable_id",
          "from_state",
          "to_state",
          "event",
          "user_id"
        ]
      },
      "TransitionSuccess": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": true
          },
          "article": {
            "$ref": "#/components/schemas/Article"
          }
        },
        "required": [
          "success",
          "article"
        ]
      },
      "TransitionError": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": false
          },
          "errors": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "example": [
              "Transition not allowed from current state"
            ]
          }
        },
        "required": [
          "success",
          "errors"
        ]
      },
      "RejectRequest": {
        "type": "object",
        "properties": {
          "rejection_feedback": {
            "type": "string",
            "example": "Please improve the introduction and add more examples.",
            "description": "Detailed feedback explaining why the content is being rejected",
            "minLength": 1,
            "maxLength": 1000
          }
        },
        "required": [
          "rejection_feedback"
        ]
      },
      "Error": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string",
            "example": "Unauthorized",
            "description": "Error message"
          },
          "status": {
            "type": "integer",
            "example": 401,
            "description": "HTTP status code"
          }
        },
        "required": [
          "error"
        ]
      }
    }
  }
}